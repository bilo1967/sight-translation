!function($){"use strict";const defaults={initialDelay:400,repeatInterval:200,preventScrollOnTouch:!0,acceleration:!1,accelerateAfter:10,minRepeatInterval:50,maxIterations:1/0,maxDuration:1/0},elementStates=new WeakMap;function handleStart(event){const element=getTargetElement(event);var options,state;element&&($(element).is(":disabled, .disabled, [aria-disabled='true']")||(state=event.delegateTarget||element,options=normalizeOptions($(state).data("holdOptions")||defaults),elementStates.has(element)||(state={controller:new AbortController,startTime:Date.now(),iteration:0,currentInterval:options.repeatInterval,options:options},elementStates.set(element,state),element.addEventListener("click",e=>{e.stopImmediatePropagation(),e.preventDefault()},{capture:!0,signal:state.controller.signal}),function(element,state,originalEvent,options){const $element=$(element);state.initialTimer=setTimeout(()=>{$element.trigger($.Event("holdstart",{originalEvent:originalEvent,startTime:state.startTime})),triggerHoldEvent(element,0,originalEvent);const repeatHandler=()=>{if(state.holdTime=Date.now()-state.startTime,state.iteration++,state.iteration>=options.maxIterations||state.holdTime>=options.maxDuration){var reason=state.iteration>=options.maxIterations?"iteration limit":"time limit";return $element.trigger($.Event("holdrepeathalt",{haltReason:reason,haltTime:Date.now(),startTime:state.startTime,iteration:state.iteration})),void clearTimers(state)}!1!==options.acceleration&&state.iteration>=options.accelerateAfter&&(state.currentInterval=Math.max(state.currentInterval*options.acceleration,options.minRepeatInterval)),triggerHoldEvent(element,state.iteration,originalEvent),state.repeatTimer=setTimeout(repeatHandler,state.currentInterval)};state.repeatTimer=setTimeout(repeatHandler,state.currentInterval)},options.initialDelay)}(element,state,event,options))))}function handleEnd(event){var state,isClick,element=getTargetElement(event);element&&elementStates.has(element)&&(state=elementStates.get(element),isClick=["mouseup","touchend"].includes(event.type),function(element,state,event,duration,isClick=!1){clearTimers(state),function(controller,now=!1){controller?.signal?.aborted||(now?controller?.abort():setTimeout(()=>controller?.abort(),0))}(state.controller),duration&&isClick?$(element).trigger("click"):duration||(duration=Date.now()-state.startTime,$(element).trigger($.Event("holdstop",{originalEvent:event,startTime:state.startTime,duration:duration,iterations:state.iteration})));elementStates.delete(element)}(element,state,event,Date.now()-state.startTime<state.options.initialDelay,isClick))}function triggerHoldEvent(element,iteration,originalEvent){var state=elementStates.get(element);$(element).trigger($.Event("holdrepeat",{originalEvent:originalEvent,iteration:iteration,startTime:state.startTime,holdTime:state.holdTime,currentInterval:state.currentInterval,accelerating:!1!==state.options.acceleration&&state.iteration>=state.options.accelerateAfter}))}function clearTimers(state){clearTimeout(state.initialTimer),clearTimeout(state.repeatTimer)}function getTargetElement(event){var container=event.delegateTarget||event.currentTarget;for(const selector of $(container).data("holdSelectors")||[]){var target=$(event.target).closest(selector)[0];if(target)return target}return event.currentTarget}function normalizeOptions(options){var id=Math.max(0,parseInt(options.initialDelay)||defaults.initialDelay),ri=Math.max(50,parseInt(options.repeatInterval)||defaults.repeatInterval);return{initialDelay:id,repeatInterval:ri,preventScrollOnTouch:!!options.preventScrollOnTouch,acceleration:"number"==typeof options.acceleration&&Math.min(1,Math.max(0,options.acceleration)),accelerateAfter:Math.max(1,parseInt(options.accelerateAfter)||defaults.accelerateAfter),minRepeatInterval:Math.max(10,parseInt(options.minRepeatInterval)||defaults.minRepeatInterval),maxIterations:Math.max(1,parseInt(options.maxIterations))||1/0,maxDuration:Math.max(id+ri,parseInt(options.maxDuration))||1/0}}$.event.special.holdrepeat={setup:function(data){},teardown:function(){},add:function(eventNamespace){var options=normalizeOptions($.extend({},defaults,eventNamespace.data));const selector=eventNamespace.selector;if(selector){const selectors=$(this).data("holdSelectors")||[];selectors.includes(selector)||$(this).data("holdSelectors",[...selectors,selector])}eventNamespace=selector?`.hold_${selector.replace(/[^a-z0-9]/gi,"")}`:"";$(this).data("holdOptions",options).on(`mousedown${eventNamespace} touchstart${eventNamespace}`,selector||null,handleStart).on(`mouseup${eventNamespace} mouseleave${eventNamespace} touchend${eventNamespace} touchcancel${eventNamespace}`,selector||null,handleEnd)},remove:function(eventNamespace){const selector=eventNamespace.selector;const selectors=$(this).data("holdSelectors")||[];$(this).data("holdSelectors",selectors.filter(s=>s!==selector));eventNamespace=`.hold_${selector.replace(/[^a-z0-9]/g,"")}`;$(this).off(`mousedown${eventNamespace} touchstart${eventNamespace}`).off(`mouseup${eventNamespace} mouseleave${eventNamespace} touchend${eventNamespace} touchcancel${eventNamespace}`)}}}(jQuery);
